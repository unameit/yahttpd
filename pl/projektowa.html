<HTML>

<HEAD>
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-2">
  <META NAME="authors" CONTENT="Lukasz Holody, Michal Jacykiewicz, Marcin Jarzab, Marek Konieczny">
  <META NAME="generator" CONTENT="Yatz's & Carlos' minds powered by Linux 2.0.36 i586">
  <TITLE>Systemy operacyjne - daemon HTTP - dokumentacja projektowa</TITLE>
</HEAD>

<BODY BACKGROUND="../../../gfx/backs/ltbrush.gif">

<H1 ALIGN="CENTER">Systemy operacyjne - projekt</H1>
<H3 ALIGN="RIGHT">
<A HREF="mailto:holody@ds5.agh.edu.pl">£ukasz Ho³ody</A><BR>
<A HREF="mailto:yac@icslab.agh.edu.pl">Micha³ Jacykiewicz</A><BR>
<A HREF="mailto:bombel@ds14.agh.edu.pl">Marcin Jarz±b</A><BR>
<A HREF="mailto:carlos@ds14.agh.edu.pl">Marek Konieczny</A>
</H3>

<B>
<BIG>
<OL TYPE="I">
<LI><A HREF="#temat">Temat zadania</A></LI>
<LI><A HREF="#zalozenia">Za³o¿enia ogólne</A></LI>
<LI><A HREF="#http">Opis protoko³u HTTP</A></LI>
  <SMALL>
  <OL>
    <LI><A HREF="#podstawy">Podstawy HTTP</A></LI>
    <LI><A HREF="#zapytanie">Zapytanie klienta</A></LI>
    <LI><A HREF="#kody">Kody odpowiedzi serwera</A></LI>
    <LI><A HREF="#naglowki">Nag³ówki HTTP</A></LI>
  </OL>
  </SMALL>
<LI><A HREF="#projekt">Projekt</A></LI>
<SMALL>
<OL>
  <LI><A HREF="#dyskusja">Dyskusja mo¿liwych wariantów realizacji projektu</A></LI>
  <!-- LI><A HREF="#obiekty">Model obiektowy</A></LI -->
  <LI><A HREF="#klasy">Opis projektowanych klas</A></LI>
  <LI><A HREF="#dzialanie">Opis sposobu funkcjonowania projektowanego oprogramowania</A></LI>
</OL>
</SMALL>
</OL>
</BIG>
</B>

<HR WIDTH="60%" SIZE="3">


<BASE HREF="http://www.whatis.com/">

<OL TYPE="I">

<A NAME="temat"></A>
<H3><LI>Temat zadania</LI></H3>
<P>
Serwer WWW (daemon HTTP).
</P>

<A NAME="zalozenia"></A>
<H3><LI>Za³o¿enia ogólne</LI></H3>

<UL TYPE="DISC">
<LI><A HREF="daemon.htm">Demon</A> HTTP pracuj±cy w ¶rodowisku <A HREF="unix.htm">UNIX</A><SMALL>&reg;</SMALL>.</LI>
<LI>Komunikacja wg protoko³u <A HREF="HTTP.htm">HTTP</A> w wersji 1.0 lub 1.1.</LI>
<LI>Implementacja w jêzyku <A HREF="cplusplu.htm">C++</A> z wykorzystaniem funkcji standardu <A HREF="posix.htm">POSIX</A>.</LI>
<LI>Wykorzystanie wielow±tkowo¶ci oraz zaawansowanych sposobów <A HREF="ipc.htm">komunikacji miêdzyprocesowej</A>.</LI>
<LI>Wydajno¶æ zbli¿ona do takich serwerów jak
<A HREF="http://www.apache.org/">Apache</A>
czy <A HREF="http://hoohoo.ncsa.uiuc.edu/">NCSA</A>.</LI>
</UL>

<HR WIDTH="20%">
<!-- BLOCKQUOTE -->
<!-- BLOCKQUOTE -->
<B>Demon (ang. <I>daemon</I>)</B> jest procesem drugoplanowym, czyli
wykonywanym w tle (nie ma przydzielonych - ani terminala, ani shella
zg³oszeniowego), który czeka albo na wyst±pienie pewnego zdarzenia,
albo na to, by wykonaæ pewne specjalne, okresowo powtarzane
zadanie.<BR>
Typowe demony systemowe (takie jak np. demon drukowania) s± procesami
o nastêpuj±cych w³a¶ciwo¶ciach:
<UL TYPE="DISC">
	<LI>S± tylko jeden raz rozpoczynane podczas inicjowania pracy systemu.</LI>
	<LI>Trwaj± przez ca³y czas pracy systemu; zazwyczaj nie umieraj± i nie s± wznawiane.</LI>
	<LI>Czêsto powo³uj± do ¿ycia nowe procesy w celu obs³u¿enia zamówieñ.
</UL>
<BR>
<DIV ALIGN="RIGHT"><SMALL>[W.Richard Stevens <I>Programowanie zastosowañ sieciowych w systemie
Unix</I>]</SMALL></DIV>
<!-- /BLOCKQUOTE -->
<!-- /BLOCKQUOTE -->

<!-- ********************************************************** -->

<A NAME="http"></A>
<H3><LI>Opis protoko³u HTTP</LI></H3>

<OL>

<A NAME="podstawy"></A>
<H4><LI>Podstawy HTTP</LI></H4>

<P>
<B>The Hyper Transfer Protocol (HTTP)</B> jest jêzykiem jakiego klienci
sieci WWW i serwery pracuj±ce w tej sieci u¿ywaj± do porozumiewania siê.
Jest to w³a¶ciwie podstawa sieci WWW. Bazuje on na wzajemnej wymianie
nag³ówków ¿±dania i odpowiedzi (ang. <I>request and response headers</I>) w
wielu wierszach. Mamy tutaj do czynienia z klientem (przegl±dark±), który
inicjuje komunikacjê, poprzez wys³anie do serwera nag³ówka ¿±dania.
Nastêpnie serwer odpowiada na to ¿±danie wys³aniem nag³ówka odpowiedzi wraz
z do³±czonymi danymi, które s± ¿±danymi zasobami (strona WWW, plik
graficzny, audio itp.).
</P>

Wszystkie transakcje HTTP budowane s± na podstawie tego samego, zasadniczego
formatu. Ka¿de zapytanie i odpowied¼ klienta sk³ada siê z trzech czê¶ci:
linii zapytania lub odpowiedzi, sekcji nag³ówków i zasadniczej czê¶ci.

<P>Klient inicjuje transakcje w sposób nastêpuj±cy:</P>

<UL TYPE="DISC">
  <LI>Po³±czenie z serwerem na porcie o okre¶lonym numerze (domy¶lnie jest to 80). Nastêpnie jest zapytanie o dokument, zawierajace polecenie <I>method</I>, po którym umieszczony jest adres dokumentu i numer wersji HTTP (u¿ywanej przez klienta).</LI>
  <LI>Nastêpnie klient przesy³a opcjonalnie informacje zawarte w nag³ówku, informuj±c serwer o swojej konfiguracji oraz akceptowanych formatach dokumentów. Ka¿da informacja zawarta w nag³ówku umieszczana jest w osobnych liniach, zawieraj±cych nazwê nag³ówka i przekazywan± warto¶æ. Na zakoñczenie czê¶ci zawieraj±cej nag³ówek wysy³ana jest pusta linia.</LI>
  <LI>Nastêpnie klient mo¿e wys³aæ dodatkowe dane (np. dane do programów <CODE>CGI</CODE> obs³uguj±ce metodê <CODE>POST</CODE>).</LI>
</UL>

<P>Natomiast serwer odpowiada w sposób nastêpuj±cy:</P>

<UL TYPE="DISC">
  <LI>Serwer wysy³a odpowied¼ w postaci linii zawieraj±cej trzy pola: wersja HTTP, kod stanu i opis. Pole zawieraj±ce wersjê HTTP informuje o numerze wersji protoko³u jaka zosta³a u¿yta do udzielenia odpowiedzi. Pole zawieraj±ce kod stanu jest polem o o trzech cyfrach zawierajacy wynik dzia³ania na serwerze, wysy³anego przez klienta zapytania. Opis, który nastêpuje po kodzie stanu, jest zwyk³ym tekstem, który w postaci notatki opisuje znaczenie kodu stanu.</LI>
  <LI>Po linii stanu, serwer wysy³a do do klienta informacje nag³ówka zawieraj±ce dane dotyczace serwera i dokumentu ¿±danego przez klienta. Po nag³ówku zawsze natêpuje linia pusta, oznaczaj±ca jegokoniec.</LI>e
  <LI>Je¶li zapytanie klienta zosta³o odebane i przetworzone pomy¶lnie, przesy³ane s± ¿±dane przez niego dane (kopia pliku lub odpowied¼ wygenerowana przez program <CODE>CGI</CODE>). Je¶li zapytanie klienta nie mo¿e byæ spe³nione, wysy³ane s± informacje dlaczego serwer nie mo¿e odpowiedzieæ na zapytanie.</LI>
</UL>

<P>
W HTTP 1.0, po zakoñczeniu wysy³ania przez serwer odpowiedzi nastêpuje
zakoñczenie transakcji i roz³±czenie z klientem. Zabezpieczeniem przed
zrywaniem po³±czeñ jest wysy³anie nag³ówka <I>Connection: Keep Alive</I>. W
HTTP 1.1, transakcja mo¿e rwaæ dopóty, dopóki program klienta lub serwer
wyra¼nie nie zarz±daj± zakoñczenia po³±czenia. Bêd±c protoko³em bez kontroli
stanu, HTTP nie mo¿e przekazywaæ informacji z jednej transakcji do drugiej,
przez co ka¿da nastêpna transakcja musi rozpoczynaæ ca³± procedurê od
pocz±tku. Zalet± takiego rozwi±zania jest to, ¿e serwer HTTP mo¿e w tym
czasie obs³u¿yæ znacznie wiêksz± liczbê odwo³añ od klientów, w³a¶nie dziêki
temu, ¿e nie jest obci±¿ony dodatkowymi zadaniami ¶ledzenia parametrów sesji
i przekazywania ich z po³±czenia na po³±czenie. Wad± natomiast konieczno¶æ
wykorzystywania ukrytych pól tekstowych lub <I>cookies</I> dla
przechowywania informacji i przekazywania ich z jednej transakcji do
drugiej.

</P>

<A NAME="zapytanie"></A>
<H4><LI>Zapytanie klienta</LI></H4>

<P>
Zapytania klienta dzielone s± na trzy czê¶ci. Pierwsza linia wysy³anej do
serwera wiadomo¶ci zawsze zawiera polecenie HTTP o nazwie <I>method</I>,
nastêpnie umieszczany jest <CODE>URI</CODE> (<I>Uniform Resources Identifier</I>)
wskazuj±cy plik lub zasoby, o które klient pyta oraz numer wersji u¿ywanego
HTTP. Nastêpne linie zapytania zawieraj± informacje nag³ówkowe, gdzie
umieszczone s± dane zawieraj±ce informacje o rodzaju danych przesy³anych do
serwera. Trzecia czê¶æ zapytania klienta zawiera zasadnicz± informacjê,
któr± s± przesy³ane do serwera dane.
</P>

<P>
Metod± jest polecenie HTTP umieszczone na pocz±tku pierwszej linii zapytania
wysy³anego przez klienta. Metoda informuje serwer o celu wys³ania zapytania.
Istniej± trzy g³ówne metody, zdefiniowane dla protoko³u HTTP: <CODE>GET</CODE>, <CODE>HEAD</CODE>,
<CODE>POST</CODE>. Inne metody równie¿ maj± przyjêt± definicjê, ale nie s± obs³ógiwane
przez tak du¿± liczbê serwerów. Nazwy metod musz± byæ pisane du¿ymi
literami.
</P>

<UL TYPE="DISC">

<A NAME="GET"></A>
<B><LI>Metoda <CODE>GET</CODE></LI></B> jest zapytaniem o informacje
znajduj±ce siê pod okre¶lonym adresem <CODE>URI</CODE> na serwerze. Jest ona powszechnie
u¿ywana przez przegl±darki do ¶ci±gania i wy¶wietlania zawarto¶ci
dokumentów. Je¶li klient w wys³anym zapytaniu u¿ywa <CODE>GET</CODE>, serwer odpowiada mu
lini± stanu, nag³ówkami oraz przesy³a potrzebne dane. Je¶li z powodu b³êdów
serwer nie jest w stanie odpowiedzieæ na zapytanie, wysy³a do klienta
wyja¶nienie w postaci tekstu umieszczonego w czê¶ci odpowiedzi zawieraj±cej
dane. Czê¶æ zasadnicza zapytania <CODE>GET</CODE> jest zawsze pusta. Jest to wiêc rodzaj
rozkazu o okre¶lony plik. Nazwa tego pliku jest zwykle okre¶lona przez
podanie pe³nej ¶cie¿ki dostêpu na serwerze. Metoda <CODE>GET</CODE> jest równie¿
wykorzystywana do przesy³ania danych z formularzy do <CODE>CGI</CODE>. Przesy³ane dane
do³±czane s± do URL i znajduj± siê w tej samej linii zapytania co polecenie
<CODE>GET</CODE>. Je¶li okre¶lono metodê jako <CODE>GET</CODE>, to po znaku zapytania, umieszczonym po
URL, dopisywane s± wszystkie pary klucz=warto¶æ, zawieraj±ce dane z
wype³nionego formularza. Pary te rozdzielane s± ampersandem. Aby u¿ywaæ
specjalnych znaków w charakterze zwyk³ych, oprogramowanie klienta musi
stosowaæ notacjê szesnastkow±.

<A NAME="HEAD"></A>
<B><LI>Metoda <CODE>HEAD</CODE></LI></B> jest z punktu widzenia sposobu
dzia³ania podobna do <CODE>GET</CODE>, z t± ró¿nic±, ¿e serwer nie wysy³a
¿adnych informacji w czê¶ci odpowiedzi przeznaczonej na dane. Metoda
<CODE>HEAD</CODE> pozwala wiêc na pobranie z serwera informacji o pliku lub
zasobach serwera. Metoda ta jest u¿ywana wtedy, gdy klient chce znale¼æ
informacjê o dokumencie i jednocze¶nie nie chce tego dokumentu kopiowaæ z
serwera. Np. klient mo¿e otrymywaæ nastêpuj±ce informacje:
<UL>
  <LI>czas ostatniej modyfikacji dokumentu (przydatne przy keszowaniu)</LI>
  <LI>rozmiar dokumentu (dane przydatne przy okre¶laniu wyrównania strony, przewidywanego czasu przesy³ania pliku itp.)</LI>
  <LI>rodzaj dokumentu (przy przegl±daniu dokumetów tylko tego samego typu)</LI>
  <LI>rodzaj serwera (w³a¶ciwe przygotowanie zapytañ)</LI>
</UL>

<A NAME="POST"></A>

<B><LI>Metoda <CODE>POST</CODE></LI></B> pozwala na przesy³anie danych do
serwera w zapytaniu wysy³anym przez klienta. Dane te s± nastêpnie kierowane
do programu dokonuj±cego ich analizy (najczê¶ciej skrypt <CODE>CGI</CODE>).
mo¿na jej u¿yæ np do:
<UL>
  <LI>serwisów sieciowych, takich jak korespondencja do grup dyskusyjnych</LI>
  <LI>programów pracuj±cych z interfejsem linii poleceñ</LI>
  <LI>dokonania adnotacji w dokumentach na serwerze</LI>
  <LI>programów obs³uguj±cych bazy danych</LI>
</UL>
Dane, które wysy³ane s± do serwera, umieszczone s± w zasadniczej czê¶ci
przesy³anego zapytania. Po przetworzeniu przez serwer zapytania typu
<CODE>POST</CODE> i jego nag³ówków, pozosta³a czê¶æ wiadomo¶ci przekazywana
jest do programu, który wskazano w <CODE>URI</CODE>. Pozwala to na translacjê danych do
postaci listy zmiennych i wartosci przetwarzanych nastêpnie przez
<CODE>CGI</CODE>.
<BR><BR>
<A NAME="INNE"></A>
<B><LI>Inne metody</LI></B>
Poni¿sze metody s± zdefiniowane, choæ nie s± zbyt czêsto stosowane:
<UL>
  <LI><CODE><B>LINK</B></CODE> - wymaga aby informacja zawarta w nag³ówku by³a skojarzona z dokumentem znajduj±cym siê na serwerze</LI>
  <LI><CODE><B>UNLINK</B></CODE> - wymaga aby informacja zawarta w nag³ówku by³a oddzielona od dokumentu na serwerze</LI>
  <LI><CODE><B>PUT</B></CODE> - wymaga aby ca³a zasadnicza czê¶æ zapytania zosta³a zapisana w okre¶lonym <CODE>URI</CODE></LI>
  <LI><CODE><B>DELETE</B></CODE> - wymaga usuniêcia danych okre¶lonych przez <CODE>URI</CODE>, znajduj±cych siê w serwerze</LI>
  <LI><CODE><B>OPTIONS</B></CODE> - wymaga przes³ania informacji o opcjach komunikacyjnych dostêpnych na serwerze. Symbol gwiazdka ( * ) oznacza przes³anie wszystkich informacji dostêpnych na serwerze</LI>  
  <LI><CODE><B>TRACE</B></CODE> - wymaga aby ca³a zasadnicza czê¶æ wysy³anego zapytania zosta³a odes³ana w nienaruszonej postaci</LI> 
</UL>

</UL>

<A NAME="kody"></A>
<H4><LI>Kody odpowiedzi serwera</LI></H4>

Odpowied¼ serwera na zapytanie klienta podzielona jest na trzy czê¶ci.
Pierwsza linia to linia odpowiedzi wys³anej przez serwer, w której znajduje
siê numer wersji HTTP, numer okre¶laj±cy status zapytania oraz krótki tekst
opisuj±cy ten status. Po pierwszej linii odpowiedzi nastêpuj±: informacja o
nag³ówku oraz zasadnicza czê¶æ wiadomo¶ci.Pierwsza linia informuje czy
zapytanie klienta powiod³o siê czy te¿ nie oraz dlaczego tak siê sta³o.
Status podawany jest za pomoc± <I>kodu odpowiedzi</I> zapisanego trzema
cyframi, po którym nastêpuje informacja wyja¶niaj±ca. Kody statusu s± zwykle
generowane przez serwery WWW, mog± byæ tak¿e generowane przez skrypty
<CODE>CGI</CODE>, które pomijaj± nag³ówki serwera i dopisuja w³asne. Kody te
pogrupowane s± w nastêpuj±ce zestawy:

<BR><BR>
<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
  <TD><B><CENTER>Zakres kodu</CENTER></B></TD>
  <TD><B><CENTER>Znaczenie odpowiedzi</CENTER></B></TD>
</TR><TR>
  <TD><CENTER>100 - 199</CENTER></TD>
  <TD>informacyjne</TD>
</TR><TR>
  <TD><CENTER>200 - 299</CENTER></TD>
  <TD>zapytanie klienta powiod³o siê</TD>
</TR><TR>
  <TD><CENTER>300 - 399</CENTER></TD>
  <TD>zapytanie klienta zosta³o przekazane, konieczne dalsze dzia³anie</TD>
</TR><TR>
  <TD><CENTER>400 - 499</CENTER></TD>
  <TD>zapytanie klienta nie powiod³o siê</TD>
</TR><TR>
  <TD><CENTER>500 - 599</CENTER></TD>
  <TD>b³±d serwera</TD>
</TR>
</TABLE>
</CENTER>

<P>
Protokó³ HTTP definiuje tylko kilka kodów w ka¿dym z podanych zakresów, inne
kody mog± byæ definiowane przez serwer. Jesli oprogramowanie otrzyma
odpowied¼ z kodem, którego nie potrafi rozpoznaæ, powinno przynajmniej
rozpoznaæ podstawowe jego znaczenie.
</P>

<A NAME="naglowki"></A>
<H4><LI>Nag³ówki HTTP</LI></H3>

Nag³ówki HTTP u¿ywane s± do przekazywania wszelkiego rodzaju informacji
pomiêdzy klientem a serwerem. S± cztery ró¿ne kategorie nag³ówków:

<OL TYPE="a">
  <LI><B>ogólne</B> - informacje nie zwi±zane z klientem, serwerem lub HTTP</LI>
  <LI><B>zapytanie</B> - preferowane formaty dokumentów i parametry serwera</LI>
  <LI><B>odpowied¼</B> - informacje na temat serwera wysy³aj±cego odpowied¼</LI>
  <LI><B>zawarto¶æ</B> - informacje o danych przesy³anych pomiedzy klientem i serwerem</LI>
</OL>

Nag³ówki z kategorii ogólne i zawarto¶æ s± takie same dla klienta i serwera.
Wszystkie nag³ówki znajduj±ce sie w wiadomo¶ci HTTP zawieraj± nazwê
nag³ówka, po której nastêpuje dwukopek (:), spacja i warto¶æ nag³ówka. W
nazwach nag³ówka nie jest rozró¿nialna wielko¶æ liter. Warto¶æ nag³ówka mo¿e
zajmowaæ kilka linii, pod warunkiem ¿e ka¿da nowa linia rozpoczyna siê
przynajmniej jedn± spacj± lub tabulatorem.

<BR>

W specyfikacji HTTP 1.1 mo¿emy wyró¿niæ:

<OL TYPE="a">
  <LI><B>nag³ówki ogólne</B> - nag³ówki te u¿ywane s± w zapytaniach klienta jak i w odpowiedziach serwera<BR></LI>
  <LI><B>nag³ówki zapytania klienta</B> - informuj± serwer o konfiguracji oprogramowania klienta i preferowanych formatach dokumentów. S± umieszczane w wiadomosciach wysy³anych przez klienta i zawieraj± informacje tylko o nim. </LI><BR>
  <LI><B>nag³ówki odpowiedzi serwera</B> - u¿ywane s± w przesy³anych przez serwer komunikatach i zawieraj± informacje o serwerze oraz sposobie w jaki obs³uguje on zapytanie. <BR></LI>
  <LI><B>nag³ówki zawarto¶ci</B> - u¿ywane s± zarówno w zapytaniach klienta jak i odpowiedziach serwera. Zawieraj± informacje o danych przesy³anych w wiadomo¶ciach HTTP.</LI>
</OL>

</OL>

<A NAME="projekt"></A>
<H3><LI>Projekt</LI></H3>
<OL>

<A NAME="dyskusja"></A>
<H4><LI>Dyskusja mo¿liwych wariantów realizacji projektu</LI></H4>

<P>
Projekt mo¿na zrealizowaæ na co najmniej kilka sposobów silnie
ró¿ni±cych siê stopniem komplikacji i przewidywan± wydajno¶ci±.
<BR>
Staraj±c siê zrobiæ demona szybkiego i wydajnego kluczowego znaczenia
nabieraj± ograniczenia narzucane przez system operacyjny. Z
ograniczeñ &quot;oficjalnych&quot; najwiêksze znaczenie dla nas ma
ograniczenie co do ilo¶ci procesów/w±tków na jednego u¿ytkownika,
maksymalnej liczby otwartych deskryptorów plików/socketów na
pojedyñczy proces oraz wielko¶ci wewnêtrznych buforów dla funkcji
s³u¿±cych do komunikacji miêdzyprocesowej. Spodziewamy siê tak¿e
ograniczeñ &quot;nieoficjalnych&quot; takich jak ograniczenie
wielko¶ci buforów przeznaczonych do operacji wej¶cia/wyj¶cia (czyli
obs³ugi systemu plików oraz komunikacji sieciowej).
</P>

<P>

Dla uproszczenia dalszych rozwa¿añ przyjmijmy, ¿e dopuszczalna liczba
procesów na jednego u¿ytkownika wynosi N i tyle¿ samo ilo¶æ otwartych
deskryptorów dla jednego procesu. Obecnie w ogólno¶ci za³o¿enie to jest
bliskie prawdy, choæ nie w ka¿dym systemie. Poni¿sza tabelka przedstawia
warto¶ci dla kilku systemów:

<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
  <TD><B><CENTER>system</CENTER></B></TD>
  <TD><B><CENTER>max user processes</CENTER></B></TD>
  <TD><B><CENTER>max open files</CENTER></B></TD>
</TR>
<TR>
  <TD>Linux 2.2</TD>
  <TD><CENTER>256</CENTER></TD>
  <TD><CENTER>1024</CENTER></TD>
</TR>
<TR>
  <TD>Solaris 2.6</TD>
  <TD><CENTER>64</CENTER></TD>
  <TD><CENTER>1024</CENTER></TD>
</TR>
<TR>
  <TD>AIX 4.3</TD>
  <TD><CENTER>512</CENTER></TD>
  <TD><CENTER>2000</CENTER></TD>
</TR>
</TABLE>
</CENTER>

Przypomnieæ tak¿e nale¿y, i¿ jeszcze nie tak dawno w systemach UNIX jeden
proces móg³ mieæ jedynie 20 jednocze¶nie otwartych plików.

</P>

<P>
Poni¿ej u¿ywamy terminu <I>wielow±tkowo¶æ</I> w znaczeniu wielu
wspó³pracuj±cych ze sob± procesów UNIXowych, nie za¶ w±tków
POSIXowych. Ró¿nica jest istotna: w±tki wspó³dziel± wszystko oprócz
stosu (czyli wspólne s± dla nich: segment danych, instrukcji,
deskryptory plików i socketów), podczas gdy procesy UNIXowe
wspó³dzieliæ mog± jedynie deskryptory oraz na wyra¼ne ¿yczenie
niewielkie obszary pamiêci.
</P>

<P>
A oto rozpatrywane przez nas warianty realizacji projektu:
</P>

<OL TYPE="a">

<B><LI></B><P>
Proces g³ówny po przyjêciu po³±czenia tworzy proces potomny. Ten
realizuje zlecenie, po czym umiera. W tym samym czasie proces g³ówny
mo¿e przyjmowaæ nastêpne po³±czenia i tworzæ kolejne procesy potomne do
obs³ugi tych¿e.
<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
  <TD><B><CENTER>zalety:</CENTER></B></TD>
  <TD><B><CENTER>wady:</CENTER></B></TD>
</TR>
<TR>
  <TD><UL TYPE="DISC">
    <LI>prostota</LI>
    <LI>wykorzystanie wielow±tkowo¶ci</LI>
  </UL></TD>
  <TD><UL TYPE="DISC">
    <LI>jeden proces obs³uguje tylko jedno po³±czenie</LI>
    <LI>czêste tworzenie i u¶miercanie procesów, a wiêc du¿e obci±¿enie systemu</LI>
    <LI>du¿a liczba ¿yj±cych na raz procesów (rzêdu N)</LI>
    <LI>ograniczenie do N ilo¶ci przyjmowanych po³±czeñ na raz</LI>
    <LI>nieakceptowalna szybko¶æ dzia³ania</LI>
  </UL></TD>
</TABLE>
</CENTER>
</P></LI>

<B><LI></B><P>

Istnieje jeden proces g³ówny i oko³o N jego dzieci realizuj±cych zlecenia.
Po przyjêciu po³±czenia proces g³ówny przekazuje je jednemu ze swoich dzieci.
Ten realizuje zlecenie, a nastêpnie czeka na kolejne. W tym samym
czasie proces g³ówny mo¿e przyjmowaæ nastêpne po³±czenia i
przekazywaæ je tym spo¶ród swoich dzieci, które s± wolne.
<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
	<TD><B><CENTER>zalety:</CENTER></B></TD>
	<TD><B><CENTER>wady:</CENTER></B></TD>
</TR>
<TR>
	<TD><UL TYPE="DISC">
		<LI>¶rednia z³o¿ono¶æ projektu i implementacji</LI>
		<LI>wykorzystanie wielow±tkowo¶ci</LI>
		<LI>niewielkie obci±¿enie systemu</LI>
	</UL></TD>
	<TD><UL TYPE="DISC">
		<LI>jeden proces obs³uguje tylko jedno po³±czenie</LI>
		<LI>ograniczenie do N ilo¶ci przyjmowanych po³±czeñ na raz</LI>
		<LI>du¿a liczba ¿yj±cych na raz procesów (rzêdu N)</LI>
	</UL></TD>
</TABLE>
</CENTER>
</P></LI>

<B><LI></B><P>
Istnieje tylko jeden proces przyjmuj±cy po³±czenia i realizuj±cy
zlecenia. Wszystko dzieje siê na <A HREF="asynchro.htm">asynchronicznych</A>
<A HREF="socket.htm">socketach</A>. Nie s± tworzone ¿adne dodatkowe procesy.
<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
	<TD><B><CENTER>zalety:</CENTER></B></TD>
	<TD><B><CENTER>wady:</CENTER></B></TD>
</TR>
<TR>
	<TD><UL TYPE="DISC">
		<LI>wzglêdna prostota</LI>
		<LI>jeden proces obs³uguje do N po³±czeñ</LI>
		<LI>niewielkie obci±¿enie systemu</LI>
		<LI>relatywnie wiêksza szybko¶æ dzia³ania</LI>
	</UL></TD>
	<TD><UL TYPE="DISC">
		<LI>ograniczenie do N ilo¶ci obs³ugiwanych po³±czeñ na raz</LI>
		<LI>nie wykorzystuje wielow±tkowo¶ci</LI>
	</UL></TD>
</TABLE>
</CENTER>
</P></LI>

<B><LI></B><P>

Istnieje jeden proces przyjmuj±cy po³±czenia i miêdzy kilka(na¶cie) a
N jego dzieci realizuj±cych zlecenia. Ka¿de dziecko mo¿e obs³ugiwaæ
do N zleceñ na raz (sockety asynchroniczne).

<CENTER>
<TABLE BORDER CELLSPACING="1" CELLPADDING="1">
<TR>
	<TD><B><CENTER>zalety:</CENTER></B></TD>
	<TD><B><CENTER>wady:</CENTER></B></TD>
</TR>
<TR>
	<TD><UL TYPE="DISC">
		<LI>wykorzystuje wielow±tkowo¶æ</LI>
		<LI>jeden proces obs³uguje do N po³±czeñ</LI>
		<LI>niewielkie obci±¿enie systemu</LI>
		<LI>wystarczy kilka(na¶cie) procesów, nie musi byæ ich a¿ N</LI>
		<LI>du¿a szybko¶æ dzia³ania</LI>
		<LI>bardzo du¿a wydajno¶æ: N * N zleceñ na raz</LI>
	</UL></TD>
	<TD><UL TYPE="DISC">
		<LI>du¿a z³o¿ono¶æ projektu i imlementacji</LI>
	</UL></TD>
</TABLE>
</CENTER>
</P></LI>


</OL>

<HR WIDTH="40%">

Nadmieniæ wypada, i¿ zysk ze stosowania wielow±tkowo¶ci nie tylko
polega na zwiêkszeniu mo¿liwej liczby otwartych deskryptorów, ale
tak¿e na mo¿liwo¶ci efektywnego zwiêkszenia szybko¶ci dzia³ania na
komputerach posiadaj±cych wiêcej ni¿ jeden procesor, kontroler
dyskowy, czy te¿ interfejs sieciowy.

<HR WIDTH="40%">

Je¶li chodzi o to, który wariant bêdzie przez nas zrealizowany, to oczywi¶cie bêdzie
to <B>d.</B>

<!-- A NAME="obiekty"></A>
<H4><LI>Model obiektowy</LI></H4 -->



<A NAME="klasy"></A>
<H4><LI>Opis projektowanych klas</LI></H4>

<UL>

<P><LI>klasa <CODE><B>Exception</B></CODE> - obiekty tej klasy bêd±
<I>wyj±tkami</I> w sensie jêzyka <CODE>C++</CODE> rzucanymi (jak
nazwa wskazuje) w sytacjach wyj±tkowych (np. niepowodzenia wywo³ania
funkcji systemowej). U³atwi to kontrolê sterownia programem oraz
generowania tre¶ciwych komunikatów o b³êdach i miejscach ich
wyst±pienia.
</LI></P>

<P><LI>klasa <CODE><B>SystemException</B></CODE> - klasa pochodna klasy
<CODE>Exception</CODE> zapewniaj±ca dodatkowo komunikaty o b³êdach
pochodz±ce bezpo¶rednio od systemu operacyjnego (na podstawie
zmiennej <CODE>errno</CODE> i funkcji
<CODE>strerror</CODE>).
</LI></P>

<P><LI>klasa <CODE><B>String</B></CODE> - klasa u³atwiaj±ce korzystanie z
danych z³o¿onych z ci±gów znaków. Potrzebna miêdzy innymi klasie
<CODE>MimeTypes</CODE>.</LI></P>

<P><LI>klasa <CODE><B>Vector</B></CODE> - implementacja struktury danych
okre¶lanej jako dynamiczna tablica. Klasa potrzebna miêdzy innymi klasie
<CODE>MimeTypes</CODE>.</LI></P>

<P><LI>klasa <CODE><B>File</B></CODE> - obiekty tej klasy to
standardowe pliki systemu UNIX<SMALL>&reg;</SMALL>.
Celem obudowania funkcji do obs³ugi plików w jedn±
klasê jest uproszczenie i uczynienie bardziej przejrzystym kodu ¼ród³owego.
</LI></P>

<P><LI>klasa <CODE><B>Socket</B></CODE> - klasa obudowuj±ca klasyczn±
obs³ugê <I>gniazdek</I> w sposób u³atwiaj±y korzystanie z nich.</LI></P>

<P><LI>klasa <CODE><B>SocketManager</B></CODE> - obiekt tej klasy bêdzie
zajmowa³ siê zarz±dzaniem prac± grupy asynchronicznych socketów</LI></P>

<P><LI>klasa <CODE><B>MimeTypes</B></CODE> - obiekt tej klasy bêdzie
potrafi³ wczytaæ plik opisu plików na podstawie ich rozszerzeñ (plik
<CODE>mime.types</CODE>) dziêki czemu bêdziemy mogli w nag³ówkach
odpowiedzi wysy³aæ informacjê na temat podejrzewanej zawato¶ci
przesy³anego pliku.
</LI></P>

<P><LI>klasa <CODE><B>HTTPRequest</B></CODE> - obiekt tej klasy bêdzie
odbiera³ i &quot;rozbiera³&quot; zapytanie przegl±darki oraz
generowa³ odpowiedni nag³ówek odpowiedzi.
</LI></P>

</UL>


<A NAME="dzialanie"></A>
<H4><LI>Opis sposobu funkcjonowania projektowanego oprogramowania</LI></H4>

Po uruchomieniu program wczyta swój plik konfiguracyjny, w którym zawarte bêd± informacje
miêdzy innymi o liczbie procesów-dzieci które powinien stworzyæ, lokalizacji
pliku <CODE>mime.types</CODE>, adres (i nr portu) na którym ma
nas³uchiwaæ.<BR>
Nastêpnie stworzy ¿±dan± liczbê procesów potomnych i zacznie
oczekiwaæ na zg³oszenia od przegl±darek (czyli klientów WWW).<BR>
Po przyjêciu po³±czenia przeka¿e je do jednego ze swoich dzieci.
Proces który otrzyma³ zlecenie, spróbuje je wykonaæ: tzn. otworzy
wskazany plik, ustali jego typ i cechy (rozmiar, data ostatniej
modyfikacji) oraz ostatecznie wy¶le do klienta.
Je¶li która¶ z tych czynno¶ci nie powiedzie siê, zostanie
wygenerowany odpowiedni kod odpowiedzi i komentarz do zaistnia³ego b³êdu.
</OL>
</UL>

</UL>
<HR WIDTH="95%">

</BODY>

</HTML>
